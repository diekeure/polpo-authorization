"use strict";!function(){function r(r){function e(r,e,i){var n,o,u,s={authorized:!0,unauthorized:!1,loginRequired:"login"},a={one:!1,all:!0},d={superuser:["superuser","editoradmin","editor","author"],editoradmin:["editoradmin","editor","author"],editor:["editor","author"],schooladmin:["schooladmin","teacher"]},l=[];if(angular.isString(e)&&(e=a[e]),e=e||a.one,void 0===r)return s.authorized;if("!"===r)return null===t||void 0===t.id?s.authorized:s.unauthorized;if(null===t||void 0===t.id)return s.loginRequired;if(void 0!==i&&i.toString()===t.id.toString())return s.authorized;if(0===r.length)return s.authorized;if(void 0===t.roles||0===t.roles.length)return s.unauthorized;for(n=0,u=t.roles.length;u>n;n++)o=t.roles[n],o=o.name,void 0===d[o]&&(d[o]=[o]),l=l.concat(d[o]);if(e===a.all){for(n=0,u=r.length;u>n;n++)if(o=r[n],-1===l.indexOf(o))return s.unauthorized;return s.authorized}if(e===a.one){for(n=0,u=r.length;u>n;n++)if(o=r[n],l.indexOf(o)>-1)return s.authorized;return s.unauthorized}return s.unauthorized}function i(i){function n(e,i){var t,o,u,s,a=r.get(e);if(i=i||{},null===a)return i;if(t=a.dkAccess||{},void 0!==t.permissions)for(i.permissions=i.permissions||[],u=0,s=t.permissions.length;s>u;u++)-1===i.permissions.indexOf(t.permissions[u])&&i.permissions.push(t.permissions[u]);if(void 0!==t.type&&(i.type=t.type),t.inherit!==!1){if(void 0===a.parent)o=e.split(".").slice(0,-1).join(".");else if(angular.isString(a.parent))o=a.parent;else{if(!angular.isObject(a.parent))return i;o=a.parent.name}return n(o,i)}return i}var t=n(i.name,i.dkAccess),o=e(t.permissions,t.type);return o}function n(r){t=r}var t=null;return{authorize:e,hasAccess:i,setUser:n}}angular.module("polpo.authorization").factory("AuthService",r)}();