!function(){"use strict";angular.module("polpo.authorization",[])}(),function(){"use strict";function e(e,r){return{transclude:"element",priority:600,restrict:"A",scope:{roles:"@dkAccess",type:"@dkAccessType",owner:"@dkAccessOwner"},link:function(n,i,t,o,u){function s(){var t=e.authorize(f,h,p)===!0?!0:!1;t?c||u(function(e,t){c=t,e[e.length++]=document.createComment(" end dkAccess: "+n.roles+" "),l={clone:e},r.enter(e,i.parent(),i)}):(d&&(d.remove(),d=null),c&&(c.$destroy(),c=null),l&&(d=a(l.clone),r.leave(d).then(function(){d=null}),l=null))}function a(e){var r=e[0],n=e[e.length-1],i=[r];do{if(r=r.nextSibling,!r)break;i.push(r)}while(r!==n);return angular.element(i)}var l,c,d,f=n.roles,h=n.type,p=n.owner;switch(f){case"*":f=void 0;break;case"!":break;case"":f=[];break;default:f=f.split(",")}n.$watch(function(){return e.getUserRoles()},function(){s()})}}}angular.module("polpo.authorization").directive("dkAccess",e),e.$inject=["AuthService","$animate"]}(),function(){"use strict";function e(e){function r(e,r,n){var i,t,u,s={authorized:!0,unauthorized:!1,loginRequired:"login"},a={one:!1,all:!0},l={superuser:["superuser","editoradmin","editor","author"],editoradmin:["editoradmin","editor","author"],editor:["editor","author"],schooladmin:["schooladmin","teacher"]},c=[];if(angular.isString(r)&&(r=a[r]),r=r||a.one,void 0===e)return s.authorized;if("!"===e)return null===o||void 0===o.id?s.authorized:s.unauthorized;if(null===o||void 0===o.id)return s.loginRequired;if(void 0!==n&&n.toString()===o.id.toString())return s.authorized;if(0===e.length)return s.authorized;if(void 0===o.roles||0===o.roles.length)return s.unauthorized;for(i=0,u=o.roles.length;u>i;i++)t=o.roles[i],t=t.name,void 0===l[t]&&(l[t]=[t]),c=c.concat(l[t]);if(r===a.all){for(i=0,u=e.length;u>i;i++)if(t=e[i],-1===c.indexOf(t))return s.unauthorized;return s.authorized}if(r===a.one){for(i=0,u=e.length;u>i;i++)if(t=e[i],c.indexOf(t)>-1)return s.authorized;return s.unauthorized}return s.unauthorized}function n(n){function i(r,n){var t,o,u,s,a=e.get(r);if(n=n||{},null===a)return n;if(t=a.dkAccess||{},void 0!==t.permissions)for(n.permissions=n.permissions||[],u=0,s=t.permissions.length;s>u;u++)-1===n.permissions.indexOf(t.permissions[u])&&n.permissions.push(t.permissions[u]);if(void 0!==t.type&&(n.type=t.type),t.inherit!==!1){if(void 0===a.parent)o=r.split(".").slice(0,-1).join(".");else if(angular.isString(a.parent))o=a.parent;else{if(!angular.isObject(a.parent))return n;o=a.parent.name}return i(o,n)}return n}var t=i(n.name,n.dkAccess),o=r(t.permissions,t.type);return o}function i(e){o=e}function t(){return o?o.roles:null}var o=null;return{authorize:r,hasAccess:n,setUser:i,getUserRoles:t}}angular.module("polpo.authorization").factory("AuthService",e),e.$inject=["$state"]}();